---
layout: layouts/base.njk
---
{# Syntax highlighter CSS #}
<style>{% include "node_modules/prismjs/themes/prism-okaidia.css" %}</style>
<style>{% include "css/prism-diff.css" %}</style>

{# Reading progress bar #}
<div class="reading-progress" id="reading-progress"></div>

<article class="post-content">
  <h1>{{ title }}</h1>
  
  <ul class="post-metadata">
    <li><time datetime="{{ page.date | htmlDateString }}">{{ page.date | readableDate }}</time></li>
    {%- for tag in tags | filterTagList %}
    {%- set tagUrl %}/tags/{{ tag | slugify }}/{% endset %}
    <li><a href="{{ tagUrl }}" class="post-tag">{{ tag }}</a></li>
    {%- endfor %}
  </ul>

  {{ content | safe }}

  {%- if collections.posts %}
  {%- set previousPost = collections.posts | getPreviousCollectionItem %}
  {%- set nextPost = collections.posts | getNextCollectionItem %}
  {%- if nextPost or previousPost %}
  <nav aria-label="Post navigation">
    <ul class="links-nextprev">
      {%- if previousPost %}
      <li class="links-nextprev-prev">
        ← Previous<br>
        <a href="{{ previousPost.url }}">{{ previousPost.data.title }}</a>
      </li>
      {% endif %}
      {%- if nextPost %}
      <li class="links-nextprev-next">
        Next →<br>
        <a href="{{ nextPost.url }}">{{ nextPost.data.title }}</a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {%- endif %}
  {%- endif %}
</article>

{# Interactive Highlighting Script #}
<script>
(function() {
  'use strict';
  
  // Reading Progress Bar
  const progressBar = document.getElementById('reading-progress');
  
  function updateProgress() {
    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight - windowHeight;
    const scrolled = window.scrollY;
    const progress = (scrolled / documentHeight) * 100;
    
    if (progressBar) {
      progressBar.style.width = Math.min(progress, 100) + '%';
    }
  }
  
  window.addEventListener('scroll', updateProgress);
  window.addEventListener('resize', updateProgress);
  updateProgress();
  
  // Text Highlighting Feature - SIMPLIFIED VERSION
  const article = document.querySelector('.post-content');
  
  if (!article) return;
  
  // Storage key for this page
  const storageKey = 'highlights_' + window.location.pathname;
  
  // Simple highlighting without localStorage (it can be added later)
  article.addEventListener('mouseup', function(e) {
    const selection = window.getSelection();
    const text = selection.toString().trim();
    
    // Only highlight if text is selected and reasonable length
    if (text.length === 0 || text.length > 300) {
      return;
    }
    
    // Get the selected range
    const range = selection.getRangeAt(0);
    
    // Make sure selection is within article
    if (!article.contains(range.commonAncestorContainer)) {
      return;
    }
    
    // Check if already highlighted
    const container = range.commonAncestorContainer.parentElement;
    if (container && container.classList.contains('user-highlight')) {
      return; // Already highlighted
    }
    
    try {
      // Create highlight span
      const span = document.createElement('mark');
      span.className = 'user-highlight';
      span.title = 'Click to remove highlight';
      
      // Wrap the selection
      range.surroundContents(span);
      
      // Add click handler to remove
      span.addEventListener('click', function(evt) {
        evt.stopPropagation();
        removeHighlight(this);
      });
      
      // Clear selection
      selection.removeAllRanges();
      
    } catch (err) {
      console.log('Could not highlight:', err.message);
    }
  });
  
  function removeHighlight(element) {
    const parent = element.parentNode;
    
    // Move all child nodes out of the highlight
    while (element.firstChild) {
      parent.insertBefore(element.firstChild, element);
    }
    
    // Remove the empty highlight element
    parent.removeChild(element);
    
    // Normalize to merge adjacent text nodes
    parent.normalize();
  }
  
  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href === '#') return;
      
      e.preventDefault();
      const target = document.querySelector(href);
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
})();
</script>